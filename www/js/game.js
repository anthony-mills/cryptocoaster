var CryptoCoaster=CryptoCoaster||{};CryptoCoaster.Game=function(){},CryptoCoaster.Game.prototype={preload:function(){CryptoCoaster.rnd=this.game.rnd,this.game.time.advancedTiming=!0,this.tileSize=70,CryptoCoaster.data.moonJump=0,CryptoCoaster.data.moonStatus="Ready",this.platfomHeights=!0,this.disableNews=!1,this.pointCutoff=288;var t=JSON.parse(sessionStorage.btcPrice);this.newsCount=0,this.newsDistance=0,this.newsJSON=JSON.parse(sessionStorage.newsData),this.newsJSON=this.shuffleArray(this.newsJSON);var e=t.market_data.length;if(e>this.pointCutoff)var a=e-this.pointCutoff;else a=0;var o=t.market_data.splice(a,this.pointCutoff);this.marketData=[];for(var r=0;r<o.length;r+=7)this.marketData.push(o[r]);this.pointCutoff=this.marketData.length},create:function(){this.world.setBounds(0,0,3e3,2e3),CryptoCoaster.data.playerDead=0,this.backgroundlayer=this.game.add.tileSprite(0,0,800,490,"playingBg"),this.backgroundlayer.fixedToCamera=!0,this.backgroundlayer.game.world.sendToBack(this.backgroundlayer),this.tileCount=0,this.tileSize=70,this.probCliff=.4,this.probVertical=.4,this.probMoreVertical=.5,this.floorTiles=this.game.add.group(),this.floorTiles.enableBody=!0,this.newsTiles=this.game.add.group(),this.newsTiles.enableBody=!0;var t={min:4,max:15,total_count:0,last_height:this.game.world.height/2-this.tileSize,group_length:0,current_length:0,paint_platforms:1,current_price:this.marketData[0].price_usd};if(CryptoCoaster.data.currentPrice=this.marketData[0].price_usd,0==t.total_count)var e=Math.floor(Math.random()*(t.max-t.min)+t.min);for(var a=[],o=0;o<this.pointCutoff-1;){if(t.current_length<e){if(1==t.paint_platforms){var r=t.total_count*this.tileSize,i=t.last_height;newItem=this.floorTiles.create(r,i,"floor"),newItem.price_usd=this.marketData[this.tileCount],newItem.body.immovable=!0,8<t.total_count&&this.createNews(r,i)}t.current_length++}else{if(t.paint_platforms=-1*t.paint_platforms,1===t.paint_platforms){if(this.tileCount++,o++,((n=Math.round(this.marketData[this.tileCount-1].price_usd-this.marketData[this.tileCount].price_usd))<0||0<n)&&(a.push(n),this.platfomHeights)){var s=Math.abs(n);if(s<35)var n=7*n;else if(35<=s&&s<50)n=5*n;else if(50<=s&&s<75)n=2*n}if(250<n)n=250;if(n<-250)n=-250;t.last_height=t.last_height+n}if(0<t.paint_platforms)e=Math.floor(Math.random()*(t.max-t.min)+t.min);else e=this.game.rnd.integerInRange(1,5);t.current_length=0}t.total_count++}var d=t.total_count*this.tileSize;if(this.world.setBounds(0,0,d,3e3),this.lastFloor=newItem,0===CryptoCoaster.data.worldLoop){CryptoCoaster.data.currentScore=0,this.runSpeed=300;var p=["To the moon!","Lambo time!","HODL tight!","Lets hunt bearwhales!","Bullish on Bitcoin..."],h=this.game.add.bitmapText(.5*this.game.camera.width,200,"market",p[Math.floor(Math.random()*p.length)],40);h.tint=13173764,h.x=.5*this.game.camera.width-.5*h.width,h.fixedToCamera=!0,this.game.time.events.add(700,function(){var t=this.game.add.tween(h);t.to({alpha:0},400,Phaser.Easing.Linear.None,!0),t.onComplete.add(function(){h.destroy()})},this)}else this.runSpeed=this.runSpeed+50,CryptoCoaster.data.worldLoop=0;this.player=this.game.add.sprite(100,800,"gameItems","1.png"),this.player.animations.add("run",["1.png","2.png","3.png","4.png","5.png","6.png","7.png"],9,!0),this.player.animations.add("explode",["explode_1.png","explode_2.png","explode_3.png","explode_4.png","explode_5.png","explode_6.png","explode_7.png"],5,!1),this.player.play("run"),this.game.physics.arcade.enable(this.player),this.player.body.gravity.y=1e3,this.player.anchor.setTo(.5,1),this.game.camera.follow(this.player),CryptoCoaster.player=this.player,this.cursors=this.game.input.keyboard.createCursorKeys(),this.moonKey=this.game.input.keyboard.addKey(Phaser.Keyboard.M),this.spaceBar=this.game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.enterKey=this.game.input.keyboard.addKey(Phaser.Keyboard.ENTER),CryptoCoaster.data.scoreObject=this.game.add.bitmapText(20,400,"market","Score: "+CryptoCoaster.data.currentScore,50),CryptoCoaster.data.scoreObject.tint=13173764,CryptoCoaster.data.scoreObject.fixedToCamera=!0,CryptoCoaster.data.moonjumpObject=this.game.add.bitmapText(20,450,"market","Moon Launch: Ready",25),CryptoCoaster.data.moonjumpObject.tint=8190976,CryptoCoaster.data.moonjumpObject.fixedToCamera=!0,CryptoCoaster.data.priceObject=this.game.add.bitmapText(20,20,"market","Price: $"+CryptoCoaster.data.currentPrice,50),CryptoCoaster.data.priceObject.tint=8190976,CryptoCoaster.data.priceObject.fixedToCamera=!0,this.gameOverSound=this.game.add.audio("gameOver"),this.jumpSound=this.game.add.audio("jump"),this.landSound=this.game.add.audio("land"),this.moonSound=this.game.add.audio("liftOff"),this.paperSound=this.game.add.audio("paperPickup"),this.game.input.onTap.add(function(){this.playerJump()},this)},createNews:function(t,e){if(this.newsCount<this.newsJSON.length-1){var a=this.game.rnd.integerInRange(5,15);if(this.newsDistance++,5<this.newsDistance&&5===a)this.newsDistance=0,this.newsTiles.create(t,e-40,"gameItems","newspaper.png").headline=this.newsJSON[this.newsCount],this.newsCount++}},update:function(){this.player.alive&&(this.game.physics.arcade.collide(this.player,this.floorTiles,this.playerHit,null,this),this.game.physics.arcade.overlap(this.player,this.newsTiles,this.collectNews,null,this),this.moonKey.isDown&&(this.moonJump(),this.player.animations.stop("run")),(this.cursors.up.isDown||this.spaceBar.isDown)&&(this.playerJump(),this.player.animations.stop("run")),this.player.x>=this.game.world.width&&this.state.start("DayComplete",!0),this.player.y>=this.game.world.height&&(this.player.kill(),this.gameOver()),0<this.player.body.velocity.x&&(this.backgroundlayer.tilePosition.x-=.5))},playerHit:function(t,e){if(t.body.blocked.right&&(this.player.play("explode"),this.player.body.allowGravity=!1,this.player.alive=!1,this.player.body.velocity.x=0,this.player.loadTexture("gameItems","dead.png"),this.gameOver()),t.body.touching.down){if(1===CryptoCoaster.data.inAir){var a=e.price_usd,o=CryptoCoaster.data.currentPrice;if(CryptoCoaster.data.currentPrice=a.price_usd,a.price_usd<o)var r="0xc90404";else r="0x7CFC00";CryptoCoaster.data.priceObject.destroy(),CryptoCoaster.data.priceObject=this.game.add.bitmapText(20,20,"market","Price: $"+a.price_usd,50),CryptoCoaster.data.priceObject.tint=r,CryptoCoaster.data.priceObject.fixedToCamera=!0,this.landSound.play(),CryptoCoaster.data.inAir=0,this.add.tween(this.player).to({angle:0},200,"Linear",!0,0)}(this.cursors.left.isDown||this.cursors.right.isDown)&&0===CryptoCoaster.data.inAir?(this.cursors.left.isDown&&50<this.player.body.velocity.x&&(this.player.body.velocity.x=this.player.body.velocity.x-20),this.cursors.right.isDown&&(this.player.body.velocity.x=this.player.body.velocity.x+20)):this.player.body.velocity.x=this.runSpeed,this.player.play("run")}},collectNews:function(t,e){if(!this.disableNews){CryptoCoaster.data.currentScore+=50,CryptoCoaster.data.scoreObject.kill(),CryptoCoaster.data.scoreObject=this.game.add.bitmapText(20,400,"market","Score: "+CryptoCoaster.data.currentScore,50),CryptoCoaster.data.scoreObject.tint=13173764,CryptoCoaster.data.scoreObject.fixedToCamera=!0;var a=this;this.openNews(e.headline),this.game.paused=!0,window.onkeydown=function(){a.enterKey.isDown&&window.open(e.headline.link,"_blank").focus();a.spaceBar.isDown&&(CryptoCoaster.data.newspaperBg.destroy(),CryptoCoaster.data.newsHeadline.destroy(),CryptoCoaster.data.newsBody.destroy(),CryptoCoaster.data.newsCont.destroy(),CryptoCoaster.data.newsRead.destroy(),e.destroy(),a.game.paused=!1)}}},openNews:function(t){CryptoCoaster.data.newspaperBg=this.add.tileSprite(0,0,800,490,"gameItems","headlines.png"),CryptoCoaster.data.newspaperBg.fixedToCamera=!0;var e=this.wordWrap(t.title,60);CryptoCoaster.data.newsHeadline=this.game.add.bitmapText(50,150,"light",e,25),CryptoCoaster.data.newsHeadline.tint=0,CryptoCoaster.data.newsHeadline.fixedToCamera=!0,CryptoCoaster.data.newsRead=this.game.add.bitmapText(50,330,"light","Press enter to read more",18),CryptoCoaster.data.newsRead.x=this.game.camera.width/2-CryptoCoaster.data.newsRead.width/2,CryptoCoaster.data.newsRead.tint=0,CryptoCoaster.data.newsRead.fixedToCamera=!0,CryptoCoaster.data.newsCont=this.game.add.bitmapText(50,360,"light","Space to continue",18),CryptoCoaster.data.newsCont.x=this.game.camera.width/2-CryptoCoaster.data.newsCont.width/2,CryptoCoaster.data.newsCont.tint=0,CryptoCoaster.data.newsCont.fixedToCamera=!0;var a=function(t,e){var a,o;if((a=t.split("")).length>e){for(o=a.length-1;-1<o;--o)if(e<o)a.length=o;else if(" "===a[o]){a.length=o;break}a.push("...")}return a.join("")}(a=(a=t.description).replace(/<(?:.|\n)*?>/gm,""),300);a=this.wordWrap(a,80),CryptoCoaster.data.newsBody=this.game.add.bitmapText(200,210,"light",a,18),CryptoCoaster.data.newsBody.tint=0,CryptoCoaster.data.newsBody.x=this.game.camera.width/2-CryptoCoaster.data.newsBody.width/2,CryptoCoaster.data.newsBody.fixedToCamera=!0},gameOver:function(){if(1!==CryptoCoaster.data.playerDead){if(CryptoCoaster.data.playerDead=1,this.gameOverSound.play(),CryptoCoaster.data.currentScore>CryptoCoaster.data.highScore){CryptoCoaster.data.highScore=CryptoCoaster.data.currentScore;var t={highScore:CryptoCoaster.data.currentScore};localStorage.high_score=JSON.stringify(t)}CryptoCoaster.data.jumpCount=0;var e=["Crashed to zero!","China actually bans bitcoin!","Tulip mania is over :-(","Shorted by whales...","Wiped out by weak hands.","Position liquidated","Private key lost","Mempool full"],a=this.game.add.bitmapText(.5*this.game.camera.width,120,"market",e[Math.floor(Math.random()*e.length)],40);a.tint=13173764,a.x=.5*this.game.camera.width-.5*a.width,a.fixedToCamera=!0,this.game.time.events.add(3500,function(){var t=this.game.add.tween(a);t.to({alpha:0},2e3,Phaser.Easing.Linear.None,!0),t.onComplete.add(function(){a.destroy()})},this),this.game.time.events.add(6e3,this.mainMenu,this)}},wordWrap:function(t,e){var a="\n";done=!1,res="";do{for(found=!1,i=e-1;0<=i;i--)if(this.testWhite(t.charAt(i))){res+=[t.slice(0,i),a].join(""),t=t.slice(i+1),found=!0;break}found||(res+=[t.slice(0,e),a].join(""),t=t.slice(e)),t.length<e&&(done=!0)}while(!done);return res+t},testWhite:function(t){return new RegExp(/^\s$/).test(t.charAt(0))},mainMenu:function(){this.game.state.start("MainMenu",!0)},playerJump:function(){1!==CryptoCoaster.data.playerDead&&(this.player.body.touching.down?(this.player.body.velocity.y-=700,CryptoCoaster.data.jumpCount=1,CryptoCoaster.data.jumpTime=this.game.time.time,CryptoCoaster.data.inAir=1,this.add.tween(this.player).to({angle:-15},200,"Linear",!0,0),this.jumpSound.play()):1==CryptoCoaster.data.jumpCount&&1e3<this.game.time.time-CryptoCoaster.data.jumpTime&&(this.player.body.velocity.y-=700,CryptoCoaster.data.jumpCount=0,this.jumpSound.play()))},moonJump:function(){if(1!==CryptoCoaster.data.playerDead&&this.player.body.touching.down&&0===CryptoCoaster.data.moonJump){this.moonSound.play(),this.player.body.velocity.y-=1500,CryptoCoaster.data.moonJump=this.game.time.time,CryptoCoaster.data.inAir=1;this.game.time.create();CryptoCoaster.data.moonTimer=this.game.time.events.add(10*Phaser.Timer.SECOND,function(){CryptoCoaster.data.moonJump=0,this.toggleMoonStatus("Moon Launch: Ready",8190976)},this),this.toggleMoonStatus("Moon Launch: Thrusters Charging",13173764),this.add.tween(this.player).to({angle:-45},200,"Linear",!0,0)}},shuffleArray:function(t){for(var e=t.length;0<e;){var a=Math.floor(Math.random()*e),o=t[--e];t[e]=t[a],t[a]=o}return t},toggleMoonStatus:function(t,e){CryptoCoaster.data.moonjumpObject.destroy(),CryptoCoaster.data.moonjumpObject=this.game.add.bitmapText(20,450,"market",t,20),CryptoCoaster.data.moonjumpObject.tint=e,CryptoCoaster.data.moonjumpObject.fixedToCamera=!0},render:function(){}};